---
phase: 07-variants-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/avatar-creator/VideoPromptPanel.tsx
  - components/avatar-creator/VideoPromptButton.tsx
  - components/avatar-creator/ImagePreview.tsx
  - components/avatar-creator/ImageGallery.tsx
autonomous: true

must_haves:
  truths:
    - "User sees variant counter in panel header (e.g. '2 von 3')"
    - "User can click prev/next arrows to navigate between variants"
    - "User can click '+Neu' button to create new variant"
    - "Each variant displays its own camera style and film effect"
    - "Variant navigation persists within session (refreshing resets to most recent)"
  artifacts:
    - path: "components/avatar-creator/VideoPromptPanel.tsx"
      provides: "Variant navigation UI and state management"
      contains: "variantIndex"
    - path: "components/avatar-creator/VideoPromptButton.tsx"
      provides: "Variant count badge display"
      contains: "promptCount"
  key_links:
    - from: "VideoPromptPanel"
      to: "useVideoPrompts hook"
      via: "prompts array with variantIndex"
      pattern: "prompts\\[variantIndex\\]"
    - from: "Navigation arrows"
      to: "setVariantIndex"
      via: "onClick handlers"
      pattern: "setVariantIndex"
---

<objective>
Implement variant navigation UI for video prompts, enabling users to create and switch between multiple prompt variants per image.

Purpose: Users often want multiple prompt variations for the same image (different camera styles, effects). This completes the variant management capability started in Phase 1 (database support).

Output: VideoPromptPanel with variant counter, navigation arrows, and "+Neu" button for creating variants.
</objective>

<execution_context>
@/Users/cweissteiner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cweissteiner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@components/avatar-creator/VideoPromptPanel.tsx
@components/avatar-creator/VideoPromptConfig.tsx
@components/avatar-creator/VideoPromptButton.tsx
@components/avatar-creator/ImagePreview.tsx
@hooks/use-video-prompts.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add variant navigation state and UI to VideoPromptPanel</name>
  <files>components/avatar-creator/VideoPromptPanel.tsx</files>
  <action>
Add variant navigation to VideoPromptPanel:

1. **State Management:**
   - Add `variantIndex` state (number, default 0 = most recent)
   - Change `currentPrompt = prompts?.[0]` to `currentPrompt = prompts?.[variantIndex]`
   - Reset variantIndex to 0 when imageId changes (useEffect with dependency on imageId)
   - When viewing an existing variant, sync config from that variant's stored values

2. **Config Sync Effect:**
   - Add useEffect that watches currentPrompt changes
   - When currentPrompt changes (navigation or new data), sync:
     - setSelectedCameraStyle(currentPrompt?.camera_style ?? "cinematic")
     - setSelectedFilmEffect(currentPrompt?.film_effects?.[0] ?? "soft")
   - This shows user what config was used for the current variant

3. **Header Update:**
   - Add variant counter badge in the header row, after the title
   - Format: "{current + 1} von {total}" (e.g., "2 von 3")
   - Only show when prompts?.length > 0
   - Styling: text-sm text-gray-400 ml-2

4. **Navigation Controls (content state only):**
   - Add navigation row above the prompt text display
   - Structure: [ChevronLeft] {X von Y} [ChevronRight]
   - Left arrow (ChevronLeft): goes to OLDER variant (variantIndex + 1), disabled when at oldest (variantIndex === prompts.length - 1)
   - Right arrow (ChevronRight): goes to NEWER variant (variantIndex - 1), disabled when at newest (variantIndex === 0)
   - Arrows use Button variant="ghost" size="icon" className="h-8 w-8"
   - Counter in center: "1 von 3" (text-sm text-gray-400)
   - Only show navigation row when prompts.length > 1 (no navigation needed for single variant)

5. **Action Buttons Row (content state):**
   - Change layout to have "Kopieren" and "+ Neu" side by side
   - Use flex gap-2 for the container
   - "Kopieren" button: same as current
   - "+ Neu" button: same onClick as current regenerate button (handleGenerate), variant="outline" style like copy
   - Text: "+ Neu" (short, fits button well)
   - After successful generation via onSuccess callback: variantIndex will auto-reset to 0 (React Query invalidates, new prompt appears at index 0)

6. **Remove Standalone Regenerate Button:**
   - The "+ Neu" button replaces the "Neuen Prompt erstellen" / outline variant button
   - Config controls and "Prompt generieren" button stay for empty state only
   - In content state: config is read-only display (shows current variant's config)
   - Remove the outline "Neuen Prompt erstellen" button from content state (replaced by "+ Neu")

7. **Layout in Content State:**
   - Variant navigation row (< 1 von 3 >) - only if multiple variants
   - Prompt text display (existing bg-white/5 div)
   - Action buttons row: "Kopieren" | "+ Neu" (side by side)
   - Metadata row (Erstellt: date, camera style)

Import ChevronLeft, ChevronRight from lucide-react.
  </action>
  <verify>
Run `npm run build` - should pass with no TypeScript errors.
Check VideoPromptPanel.tsx imports ChevronLeft, ChevronRight.
Check for useState with variantIndex.
Check for prompts?.[variantIndex] usage.
Check for useEffect that syncs config from currentPrompt.
  </verify>
  <done>
Panel displays variant counter when prompts exist.
Navigation arrows appear when multiple variants exist.
Config syncs automatically when switching variants.
"+Neu" button creates new variant.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update VideoPromptButton badge to show variant count</name>
  <files>
    components/avatar-creator/VideoPromptButton.tsx
    components/avatar-creator/ImagePreview.tsx
    components/avatar-creator/ImageGallery.tsx
  </files>
  <action>
Update VideoPromptButton and its callers to show variant count:

**VideoPromptButton.tsx:**
1. Change prop from `hasPrompts?: boolean` to `promptCount?: number` (default 0)
2. Badge display logic:
   - If promptCount === 0: no badge shown
   - If promptCount === 1: show small green dot (same as current, keeps pulse animation)
   - If promptCount > 1: show number badge with the count
3. Badge styling for count > 1:
   - Position: absolute -top-1 -right-1 (same as current dot)
   - Background: bg-green-400 text-black font-medium
   - Size: min-w-[18px] h-[18px] rounded-full
   - Text: text-xs, centered with flex items-center justify-center
   - Border: border-2 border-black (same as current dot)

**ImagePreview.tsx:**
1. Change prop from `hasVideoPrompts?: boolean` to `videoPromptCount?: number` (default 0)
2. Pass to VideoPromptButton: `promptCount={videoPromptCount}`

**ImageGallery.tsx:**
1. Change from `hasVideoPrompts` boolean to pass count directly
2. Currently: `const hasVideoPrompts = (videoPrompts?.length ?? 0) > 0`
3. Change to: `const videoPromptCount = videoPrompts?.length ?? 0`
4. Update ImagePreview prop: `videoPromptCount={videoPromptCount}`
  </action>
  <verify>
Run `npm run build` - should pass.
Check VideoPromptButton prop is promptCount (number).
Check ImagePreview prop is videoPromptCount (number).
Check ImageGallery passes videoPromptCount correctly.
Check badge renders number when count > 1.
  </verify>
  <done>
Button shows dot for 1 prompt, number badge for 2+ prompts, nothing for 0 prompts.
All callers updated with correct prop names.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build` passes
2. `npm run lint` passes
3. VideoPromptPanel has variantIndex state with navigation
4. Navigation arrows visible when multiple prompts exist
5. Badge on button reflects actual count (number when > 1)
6. Config syncs when navigating variants
</verification>

<success_criteria>
1. User sees "X von Y" counter in panel when prompts exist
2. Prev/next arrows navigate between variants (only shown when > 1 variant)
3. "+Neu" creates new variant and selects it (automatically via React Query invalidation)
4. Each variant shows its stored config (synced via useEffect)
5. Button badge shows count when multiple variants exist
</success_criteria>

<output>
After completion, create `.planning/phases/07-variants-navigation/07-01-SUMMARY.md`
</output>
