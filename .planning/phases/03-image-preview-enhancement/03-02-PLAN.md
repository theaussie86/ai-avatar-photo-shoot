---
phase: 03-image-preview-enhancement
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - components/avatar-creator/PreviewPanelLayout.tsx
  - components/ui/sheet.tsx
  - components/ui/drawer.tsx
  - components/avatar-creator/ImageGallery.tsx
autonomous: true

must_haves:
  truths:
    - "Layout container has slot for panel content"
    - "Preview area shrinks to ~50% when panel opens (desktop)"
    - "Mobile uses drawer pattern that slides up from bottom"
    - "Panel open/close state is tracked and can be toggled"
    - "Layout responds to viewport width (>=1024px desktop, <1024px mobile)"
  artifacts:
    - path: "components/avatar-creator/PreviewPanelLayout.tsx"
      provides: "Responsive layout wrapper with panel slot"
      min_lines: 80
    - path: "components/ui/sheet.tsx"
      provides: "Side sheet component for desktop panel"
      min_lines: 40
    - path: "components/ui/drawer.tsx"
      provides: "Bottom drawer component for mobile panel"
      min_lines: 40
  key_links:
    - from: "components/avatar-creator/ImageGallery.tsx"
      to: "components/avatar-creator/PreviewPanelLayout.tsx"
      via: "wraps carousel content"
      pattern: "<PreviewPanelLayout"
    - from: "components/avatar-creator/PreviewPanelLayout.tsx"
      to: "components/ui/sheet.tsx"
      via: "renders sheet on desktop"
      pattern: "<Sheet"
    - from: "components/avatar-creator/PreviewPanelLayout.tsx"
      to: "components/ui/drawer.tsx"
      via: "renders drawer on mobile"
      pattern: "<Drawer"
---

<objective>
Create responsive layout container that adapts when video prompt panel opens/closes.

Purpose: Establish the structural foundation for the side panel (Phase 4) with proper responsive behavior - side sheet on desktop, bottom drawer on mobile.

Output: PreviewPanelLayout component with sheet/drawer UI components, integrated into ImageGallery dialog.
</objective>

<execution_context>
@/Users/cweissteiner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cweissteiner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-image-preview-enhancement/03-CONTEXT.md
@.planning/phases/03-image-preview-enhancement/03-01-SUMMARY.md

# Existing components
@components/ui/dialog.tsx
@components/avatar-creator/ImageGallery.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Sheet and Drawer UI components</name>
  <files>
    - components/ui/sheet.tsx
    - components/ui/drawer.tsx
  </files>
  <action>
1. Create `components/ui/sheet.tsx`:
   - Use @radix-ui/react-dialog as base (already in package.json)
   - Sheet slides in from right side
   - Props: open, onOpenChange, children
   - Exports: Sheet, SheetTrigger, SheetContent, SheetHeader, SheetTitle, SheetDescription, SheetClose
   - Styling: dark theme (bg-gray-900 border-white/10), fixed right-0 inset-y-0
   - Width: w-[400px] or w-full max-w-[400px]
   - Animation: slide-in-from-right

2. Create `components/ui/drawer.tsx`:
   - Use vaul library pattern OR @radix-ui/react-dialog with bottom positioning
   - Since vaul is not in package.json, use Dialog with custom positioning
   - Drawer slides up from bottom
   - Props: open, onOpenChange, children
   - Exports: Drawer, DrawerTrigger, DrawerContent, DrawerHeader, DrawerTitle, DrawerDescription, DrawerClose
   - Styling: dark theme, fixed bottom-0 inset-x-0, rounded-t-xl
   - Height: h-[70vh] max-h-[70vh]
   - Animation: slide-in-from-bottom
   - Backdrop: dims/blurs the preview behind (match CONTEXT.md decision)

Both components should follow existing dialog.tsx patterns for consistency.
  </action>
  <verify>
   - Files exist with correct exports
   - TypeScript compiles: `npm run build`
  </verify>
  <done>Sheet and Drawer UI components exist with proper dark theme styling and animations</done>
</task>

<task type="auto">
  <name>Task 2: Create PreviewPanelLayout component</name>
  <files>components/avatar-creator/PreviewPanelLayout.tsx</files>
  <action>
Create `components/avatar-creator/PreviewPanelLayout.tsx`:

"use client" component with props:
- `children: React.ReactNode` (the preview content)
- `panelContent?: React.ReactNode` (the panel content, rendered in sheet/drawer)
- `isPanelOpen: boolean`
- `onPanelOpenChange: (open: boolean) => void`

Behavior:
1. Use `useMediaQuery` hook or CSS/Tailwind responsive approach to detect viewport
   - Desktop: width >= 1024px (lg breakpoint)
   - Mobile: width < 1024px

2. Desktop layout (isPanelOpen=true):
   - Flex container: `flex`
   - Preview area: `flex-1 min-w-[50%]` (shrinks but maintains minimum 50%)
   - Panel area: Sheet component, width ~400px

3. Desktop layout (isPanelOpen=false):
   - Preview takes full width

4. Mobile layout:
   - Preview takes full width/height
   - Panel renders as Drawer (slides up from bottom)
   - When drawer opens, preview stays but dims/blurs

5. Create simple useMediaQuery hook:
   - `const isDesktop = useMediaQuery('(min-width: 1024px)')`
   - Use window.matchMedia with useEffect/useState
   - Handle SSR (default to desktop or null)

Conditional rendering:
- If isDesktop && isPanelOpen: render Sheet with panelContent
- If !isDesktop && isPanelOpen: render Drawer with panelContent
- Sheet/Drawer use controlled open state from props
  </action>
  <verify>
   - Component renders children correctly
   - Panel slot receives content
   - TypeScript compiles without errors
  </verify>
  <done>PreviewPanelLayout component handles responsive layout with sheet (desktop) and drawer (mobile) patterns</done>
</task>

<task type="auto">
  <name>Task 3: Integrate PreviewPanelLayout into ImageGallery</name>
  <files>components/avatar-creator/ImageGallery.tsx</files>
  <action>
Update ImageGallery.tsx to use PreviewPanelLayout:

1. Add state for panel:
   - `const [isPanelOpen, setIsPanelOpen] = useState(false)`

2. Import PreviewPanelLayout

3. Wrap the carousel viewport area with PreviewPanelLayout:
   - Pass carousel as children
   - Pass placeholder panel content: `<div className="p-4 text-white">Panel content (Phase 4)</div>`
   - Pass isPanelOpen and onPanelOpenChange={setIsPanelOpen}

4. Wire VideoPromptButton to toggle panel:
   - In ImagePreview, onVideoPromptClick should call setIsPanelOpen(true)
   - Pass this callback down through the component tree

5. Add close button in panel content (temporary):
   - Button to setIsPanelOpen(false) for testing

6. Ensure the dialog structure still works:
   - DialogContent contains the full layout
   - Toolbar remains at top
   - PreviewPanelLayout contains carousel + panel

7. When panel is open, update ImagePreview isSelected state:
   - Current image should show selected border when its panel is open
  </action>
  <verify>
   - `npm run build` succeeds
   - Open gallery dialog
   - Click video button on image
   - Desktop: sheet slides in from right, preview shrinks
   - Mobile: drawer slides up from bottom, preview dims
   - Click close or outside to close panel
   - All existing gallery controls still work
  </verify>
  <done>ImageGallery integrates PreviewPanelLayout with working panel toggle via VideoPromptButton</done>
</task>

</tasks>

<verification>
1. `npm run build` - No TypeScript or build errors
2. Visual tests:
   - Desktop (>= 1024px): Click video button, sheet slides in from right
   - Desktop: Preview area shrinks to ~50% when panel is open
   - Mobile (< 1024px): Click video button, drawer slides up from bottom
   - Mobile: Preview dims/blurs behind drawer
3. Functionality:
   - Panel opens when VideoPromptButton clicked
   - Panel closes when close button clicked
   - Panel closes when clicking outside (on overlay)
   - Carousel navigation still works with panel open
   - Zoom controls still work
</verification>

<success_criteria>
- PreviewPanelLayout provides responsive panel behavior
- Desktop uses side sheet pattern
- Mobile uses bottom drawer pattern
- Preview maintains minimum 50% width when panel is open (desktop)
- Panel open/close can be triggered from VideoPromptButton
- All existing ImageGallery functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/03-image-preview-enhancement/03-02-SUMMARY.md`
</output>
