---
phase: 03-image-preview-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/avatar-creator/ImagePreview.tsx
  - components/avatar-creator/VideoPromptButton.tsx
  - components/ui/skeleton.tsx
autonomous: true

must_haves:
  truths:
    - "User sees image with proper aspect ratio (contain/letterbox, no cropping)"
    - "Image loading shows skeleton shimmer state"
    - "Video prompt button is visible in bottom-right corner of image"
    - "Button shows badge indicator when prompts exist for the image"
    - "Preview has subtle hover effect (scale/shadow)"
  artifacts:
    - path: "components/avatar-creator/ImagePreview.tsx"
      provides: "Letterbox image preview with loading states"
      min_lines: 60
    - path: "components/avatar-creator/VideoPromptButton.tsx"
      provides: "Trigger button with badge indicator"
      min_lines: 30
    - path: "components/ui/skeleton.tsx"
      provides: "Shimmer loading skeleton component"
      min_lines: 10
  key_links:
    - from: "components/avatar-creator/ImagePreview.tsx"
      to: "components/avatar-creator/VideoPromptButton.tsx"
      via: "renders button as overlay"
      pattern: "<VideoPromptButton"
---

<objective>
Create enhanced image preview component with letterbox layout, loading states, and video prompt trigger button.

Purpose: Prepare the image viewing experience for video prompt panel integration (Phase 4) with polished aspect ratio handling and clear trigger point for opening the panel.

Output: ImagePreview.tsx component with letterbox layout, skeleton loading, and VideoPromptButton overlay.
</objective>

<execution_context>
@/Users/cweissteiner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cweissteiner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-image-preview-enhancement/03-CONTEXT.md

# Existing patterns
@components/ui/button.tsx
@components/ui/badge.tsx
@components/avatar-creator/ImageCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create skeleton component and VideoPromptButton</name>
  <files>
    - components/ui/skeleton.tsx
    - components/avatar-creator/VideoPromptButton.tsx
  </files>
  <action>
1. Create `components/ui/skeleton.tsx`:
   - Standard shadcn/ui skeleton pattern with shimmer animation
   - Use Tailwind's animate-pulse or custom shimmer keyframes
   - Export `Skeleton` component accepting className prop

2. Create `components/avatar-creator/VideoPromptButton.tsx`:
   - "use client" component
   - Props: `hasPrompts?: boolean` (shows badge when true), `onClick?: () => void`
   - Render Button with Video icon (lucide-react)
   - Position: absolute bottom-3 right-3 (parent handles relative)
   - Badge: small dot indicator (top-right of button) when hasPrompts is true
   - Styling: bg-black/60 backdrop-blur, white icon, hover:bg-black/80
   - Use existing Button component with size="icon"
  </action>
  <verify>
   - Files exist with correct exports
   - TypeScript compiles: `npm run build` (or `npx tsc --noEmit`)
  </verify>
  <done>Skeleton and VideoPromptButton components exist with proper typing and exports</done>
</task>

<task type="auto">
  <name>Task 2: Create ImagePreview component</name>
  <files>components/avatar-creator/ImagePreview.tsx</files>
  <action>
Create `components/avatar-creator/ImagePreview.tsx`:

"use client" component with props:
- `image: { id: string; url: string; status?: string }`
- `hasVideoPrompts?: boolean`
- `onVideoPromptClick?: () => void`
- `isSelected?: boolean` (for border highlight when panel is open)

Structure:
1. Outer container: `relative aspect-square` (or configurable aspect ratio)
2. Background: subtle gray (bg-zinc-900 or similar) for letterbox effect
3. Image wrapper: `flex items-center justify-center w-full h-full`
4. Image: `object-contain max-w-full max-h-full` (letterbox, no cropping)
5. Loading state: Skeleton overlay when image is loading (use img onLoad)
6. VideoPromptButton: absolute positioned, always visible
7. Hover effect: group-hover:scale-[1.02] with transition, subtle shadow increase
8. Selected state: ring-2 ring-purple-500 border when isSelected is true

Handle loading:
- useState for `isLoaded`
- Show Skeleton shimmer while !isLoaded
- Set isLoaded=true on img onLoad event
- Ensure image is hidden (opacity-0) until loaded for smooth transition

Match existing app styling patterns (dark theme, white/10 borders).
  </action>
  <verify>
   - Component renders correctly: add temporary usage in any page to visual test
   - TypeScript compiles without errors
   - Image displays with letterbox (gray bars visible for non-square images)
  </verify>
  <done>ImagePreview component renders images with letterbox layout, skeleton loading, trigger button overlay, and hover/selection states</done>
</task>

<task type="auto">
  <name>Task 3: Integrate ImagePreview into ImageGallery dialog</name>
  <files>components/avatar-creator/ImageGallery.tsx</files>
  <action>
Update the carousel in ImageGallery.tsx to use ImagePreview:

1. Import ImagePreview component
2. Replace the current `<img>` in CarouselItem with `<ImagePreview>`:
   - Pass `image={img}`
   - Pass `hasVideoPrompts={false}` (will be wired in Phase 4)
   - Pass `onVideoPromptClick={() => console.log('open panel')}` (placeholder, Phase 4 wires actual functionality)
   - For now, isSelected can be false

3. Adjust carousel item styling:
   - Container should have gray background for letterbox effect
   - Remove redundant zoom styling (let ImagePreview handle aspect ratio)
   - Keep zoom controls working on the container level

4. Ensure existing zoom functionality still works:
   - The scale transform should apply to ImagePreview wrapper
   - ImagePreview internal image uses object-contain

Keep backward compatibility: existing delete, download, carousel navigation all still work.
  </action>
  <verify>
   - `npm run build` succeeds
   - Open gallery dialog, images display with letterbox layout
   - Video prompt button visible on each image
   - Zoom in/out still works
   - Previous/next navigation still works
  </verify>
  <done>ImageGallery uses ImagePreview component with visible trigger button and maintained existing functionality</done>
</task>

</tasks>

<verification>
1. `npm run build` - No TypeScript or build errors
2. Visual: Open a collection, click an image to open gallery
   - Image displays with letterbox (gray background visible on non-square images)
   - Video camera button visible in bottom-right corner
   - Skeleton shimmer shows briefly while image loads
   - Hover on image shows subtle scale effect
3. Existing functionality preserved:
   - Zoom controls work
   - Carousel navigation works
   - Download/delete buttons work
</verification>

<success_criteria>
- ImagePreview component renders images with contain (letterbox) aspect ratio
- VideoPromptButton appears on all preview images
- Skeleton loading state shows while image loads
- Gallery dialog uses new ImagePreview component
- All existing gallery functionality (zoom, navigate, download, delete) still works
</success_criteria>

<output>
After completion, create `.planning/phases/03-image-preview-enhancement/03-01-SUMMARY.md`
</output>
