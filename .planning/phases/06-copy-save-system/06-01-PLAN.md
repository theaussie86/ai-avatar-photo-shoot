---
phase: 06-copy-save-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - hooks/use-copy-to-clipboard.ts
  - components/avatar-creator/VideoPromptPanel.tsx
autonomous: true

must_haves:
  truths:
    - "User clicks Kopieren button and prompt text is copied to clipboard"
    - "Toast notification 'Kopiert!' appears after successful copy"
    - "Copy button shows checkmark briefly (1-2s) then returns to copy icon"
    - "Copy works on both desktop and mobile browsers"
  artifacts:
    - path: "hooks/use-copy-to-clipboard.ts"
      provides: "Clipboard copy logic with haptic feedback and fallback"
      exports: ["useCopyToClipboard"]
    - path: "components/avatar-creator/VideoPromptPanel.tsx"
      provides: "Copy button below prompt text in content state"
      contains: "Kopieren"
  key_links:
    - from: "components/avatar-creator/VideoPromptPanel.tsx"
      to: "hooks/use-copy-to-clipboard.ts"
      via: "useCopyToClipboard hook import"
      pattern: "useCopyToClipboard"
    - from: "components/avatar-creator/VideoPromptPanel.tsx"
      to: "sonner toast"
      via: "toast.success call on copy success"
      pattern: "toast\\.success.*Kopiert"
---

<objective>
Add clipboard copy functionality to the video prompt panel with visual and haptic feedback

Purpose: Enable users to copy generated video prompts for use in external tools (Runway, Pika, Kling)
Output: Working copy button in panel with toast confirmation and visual feedback
</objective>

<execution_context>
@/Users/cweissteiner/.claude/get-shit-done/workflows/execute-plan.md
@/Users/cweissteiner/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-copy-save-system/06-CONTEXT.md
@components/avatar-creator/VideoPromptPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useCopyToClipboard hook</name>
  <files>hooks/use-copy-to-clipboard.ts</files>
  <action>
Create a custom React hook for clipboard copy functionality with:

1. **State management:**
   - `isCopied` boolean state (tracks success for visual feedback)
   - `isError` boolean state (tracks failure)
   - Auto-reset both states after 2 seconds

2. **Copy function:**
   - Use Clipboard API: `navigator.clipboard.writeText(text)`
   - On success: set `isCopied: true`, trigger haptic feedback if available
   - On error: set `isError: true`
   - Return promise for caller to handle toast

3. **Haptic feedback (mobile):**
   - Check for `navigator.vibrate` support
   - Call `navigator.vibrate(50)` on successful copy (50ms = subtle)
   - Gracefully ignore if not supported

4. **Fallback for older browsers:**
   - If Clipboard API unavailable, create temporary textarea
   - Set textarea value, select text, use `document.execCommand('copy')`
   - Return success/failure from fallback

5. **TypeScript types:**
   - Export hook return type for consumers
   - Accept optional configuration (resetDelay?: number)

Pattern reference: Follow existing hook patterns in `hooks/` directory (useVideoPrompts, useGenerateVideoPrompt)
  </action>
  <verify>
File exists at `hooks/use-copy-to-clipboard.ts` and contains:
- useCopyToClipboard function export
- navigator.clipboard.writeText usage
- navigator.vibrate for haptic feedback
- setTimeout for state reset
- Fallback using document.execCommand
  </verify>
  <done>
Hook exports useCopyToClipboard function with isCopied, isError states and copy function
  </done>
</task>

<task type="auto">
  <name>Task 2: Add copy button to VideoPromptPanel</name>
  <files>components/avatar-creator/VideoPromptPanel.tsx</files>
  <action>
Update VideoPromptPanel to add copy button with visual feedback in the content state:

1. **Import additions:**
   - Import useCopyToClipboard from hooks
   - Import Copy, Check icons from lucide-react

2. **Hook usage:**
   - Call useCopyToClipboard() in component
   - Destructure { copy, isCopied, isError }

3. **Copy button placement:**
   - Add button BELOW the prompt text container (after the bg-white/5 div)
   - Before the metadata section
   - Full width like regenerate button

4. **Button styling (from CONTEXT.md):**
   - Standard outline style matching regenerate button
   - Border: `border-white/20` (subtle)
   - Text: `text-white`
   - Hover: `hover:bg-white/5`
   - Icon: Copy or Check based on isCopied state

5. **Click handler:**
   - Call `copy(currentPrompt.prompt_text)`
   - On success: call `toast.success("Kopiert!")` with duration 2000
   - On error: call `toast.error("Kopieren fehlgeschlagen")` with description

6. **Visual feedback:**
   - Default icon: Copy (from lucide-react)
   - Success state (isCopied=true): Check icon with green color
   - Button text: "Kopieren" always (icon indicates state)

7. **German text:**
   - Button label: "Kopieren"
   - Success toast: "Kopiert!"
   - Error toast: "Kopieren fehlgeschlagen"
   - Error description: "Text konnte nicht kopiert werden"

Do NOT change toast position in layout.tsx - keep existing top-right position (per existing app pattern).
  </action>
  <verify>
1. `npm run build` passes
2. VideoPromptPanel.tsx contains:
   - useCopyToClipboard import and usage
   - Copy/Check icon imports
   - Button with "Kopieren" text
   - toast.success("Kopiert!") call
3. Button appears below prompt text in content state
  </verify>
  <done>
Copy button with checkmark feedback and toast notification integrated into panel content state
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes without TypeScript errors
2. useCopyToClipboard hook exports correctly
3. VideoPromptPanel renders copy button in content state (when prompt exists)
4. Button shows Copy icon by default, Check icon briefly after successful copy
5. Toast appears with "Kopiert!" message on success
</verification>

<success_criteria>
- Copy button visible below prompt text in panel
- Clicking button copies prompt text to clipboard
- Visual feedback: checkmark icon appears briefly (1-2s)
- Toast notification confirms copy: "Kopiert!"
- Error handling works with fallback message
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-copy-save-system/06-01-SUMMARY.md`
</output>
