# Milestone v1.0: Video Prompt Generation

**Status:** SHIPPED 2026-01-26
**Phases:** 1-8
**Total Plans:** 12

## Overview

This milestone delivered video prompt generation capability to the AI Avatar Photo Shoot app. Users can open a side panel from any generated image, configure camera movements and film effects, and generate AI-powered video prompts optimized for external tools like Runway, Pika, and Kling. The journey started with database foundation and core Gemini integration (Phase 1-2), built the panel UI and basic generation workflow (Phase 3-4), added variant management and copy functionality (Phase 5-6), and finished with AI-powered suggestions and quality feedback (Phase 7-8). The roadmap validated the critical language requirement early in Phase 2 (English prompts chosen for optimal video AI compatibility) and enabled iterative refinement through multi-variant support.

## Phases

### Phase 1: Database Foundation

**Goal**: Database schema supports video prompts with user ownership, variant tracking, and proper cascading
**Depends on**: Nothing (first phase)
**Plans**: 1 plan

Plans:
- [x] 01-01: Create video_prompts table with RLS policies and CASCADE delete

**Details:**
- video_prompts table with all required fields (prompt_text, camera_style, film_effect, status, variant_order)
- RLS policies enforce user ownership (users can only access their own prompts)
- Deleting an image automatically deletes associated video prompts (CASCADE works)
- Multiple variants can be stored per image with proper ordering

### Phase 2: Core Prompt Generation

**Goal**: System generates video prompts from images using Gemini (English prompts for AI tool compatibility, German UI preserved)
**Depends on**: Phase 1
**Plans**: 3 plans

Plans:
- [x] 02-01: Video prompt schemas and system prompt
- [x] 02-02: Server action for video prompt generation
- [x] 02-03: Language validation checkpoint (English prompts, German UI)

**Details:**
- Server action analyzes image and generates video prompt via Gemini
- Generated prompts include image content, user instructions, and configuration
- Language strategy validated (English prompts chosen for optimal video AI compatibility)
- Async generation creates pending record, updates to completed after Gemini responds
- Failed generations update status to failed with error message

**Completed Note**: Language checkpoint executed fallback strategy - English prompts for optimal Runway/Pika/Kling compatibility, German UI labels preserved for user experience.

### Phase 3: Image Preview Enhancement

**Goal**: Image preview component has improved layout and integration points for video prompt panel
**Depends on**: Phase 2
**Plans**: 2 plans

Plans:
- [x] 03-01: Enhanced preview component with letterbox layout and trigger button
- [x] 03-02: Responsive layout container with sheet/drawer panel integration

**Details:**
- Image preview shows images with proper sizing and aspect ratio handling
- Layout adapts responsively when panel opens (desktop) or drawer appears (mobile)
- Video prompt trigger button appears in preview UI
- Preview component structure supports panel integration without breaking existing functionality

**Completed Note**: Letterbox layout with object-contain prevents cropping. Responsive panel layout: side sheet (desktop >=1024px) and bottom drawer (mobile). VideoPromptButton triggers panel toggle.

### Phase 4: Panel UI Foundation

**Goal**: Users can open and close video prompt panel without data loss
**Depends on**: Phase 3
**Plans**: 1 plan

Plans:
- [x] 04-01: VideoPromptPanel component with loading/empty/error states and database integration

**Details:**
- User clicks video icon button and panel opens as side panel (desktop) or drawer (mobile)
- Panel displays placeholder content (scrollable area ready for prompt text)
- User closes panel and state persists (reopening shows same content)
- Panel layout is responsive (Sheet on desktop >=1024px, Drawer on mobile)

**Completed Note**: VideoPromptPanel with 4 states (loading/error/empty/content). useVideoPrompts hook provides React Query integration. Badge indicator reflects actual database state.

### Phase 5: Configuration Controls

**Goal**: Users can select camera styles and film effects that influence prompt generation
**Depends on**: Phase 4
**Plans**: 1 plan

Plans:
- [x] 05-01: Configuration chips and generation integration

**Details:**
- Panel displays camera style options (Cinematic, Slow Motion, Zoom-In, Orbit, Dolly, Statisch) as single-select controls
- Panel displays film effect options (Dramatisch, Weich, Golden Hour, Noir, Vertraumt) as single-select controls
- Selected options visually indicate active state
- Selected options are passed to Gemini during prompt generation
- Generated prompts reflect chosen camera style and film effect

**Completed Note**: Chip-based camera style (6 options) and film effect (5 options) selection integrated into VideoPromptPanel. React Query mutation with cache invalidation enables prompt generation. Default selections: Cinematic + Weich.

### Phase 6: Copy & Save System

**Goal**: Users can copy prompts to clipboard and prompts persist in database
**Depends on**: Phase 5
**Plans**: 1 plan

Plans:
- [x] 06-01: Copy button with clipboard functionality and visual feedback

**Details:**
- User clicks "Kopieren" button and prompt text copies to clipboard
- Toast notification confirms successful copy
- Copy action works on both desktop and mobile
- Generated prompts save to database automatically (linked to image)
- Reopening panel for same image loads previously generated prompt

**Completed Note**: useCopyToClipboard hook with Clipboard API + execCommand fallback, haptic feedback on mobile. Copy button below prompt text with checkmark feedback and "Kopiert!" toast.

### Phase 7: Variants & Navigation

**Goal**: Users can create and navigate between multiple prompt variants per image
**Depends on**: Phase 6
**Plans**: 1 plan

Plans:
- [x] 07-01: Variant navigation UI with counter, arrows, and new variant button

**Details:**
- User sees variant counter in panel header (e.g., "2 von 3")
- User can click prev/next arrows to navigate between variants
- User can click "+Neu" button to create new variant
- Each variant maintains its own configuration (camera style, film effect)
- Variant order persists correctly across sessions

**Completed Note**: Variant navigation with composite state pattern for imageId-scoped index. Header counter ("X von Y"), navigation arrows (older/newer), "+Neu" button for new variants. VideoPromptButton badge shows count when multiple variants exist.

### Phase 8: AI Suggestions & Quality Feedback

**Goal**: Users receive AI-powered action suggestions and prompt quality guidance
**Depends on**: Phase 7
**Plans**: 2 plans

Plans:
- [x] 08-01: Fixed suggestions, instruction input, and prompt length feedback
- [x] 08-02: AI-generated suggestions via Gemini image analysis

**Details:**
- Panel displays 3-5 AI-generated suggestions based on image analysis
- Panel displays fixed action suggestions (lächeln, winken, nicken, drehen)
- User can click suggestion to populate instruction field
- Selected suggestions show visual active state
- Panel displays word count and length indicator (green: 50-150 words, red: >200 words)

**Completed Note**: Fixed action suggestions with chip-based toggle UI. AI-generated suggestions via Gemini image analysis with sparkle icon distinction. Instruction textarea for custom input. Word count feedback with color thresholds (green 50-150, yellow 151-200, red >200).

---

## Milestone Summary

**Key Decisions:**

| Decision | Rationale | Outcome |
|----------|-----------|---------|
| English prompts for video AI tools | Runway/Pika/Kling trained on English datasets | ✓ Good - no German testing needed |
| Seitenpanel statt Modal | Bild bleibt sichtbar während Prompt-Bearbeitung | ✓ Good - better UX |
| Varianten statt Überschreiben | Nutzer kann Prompt-Historie behalten und vergleichen | ✓ Good - enables iteration |
| 30s React Query staleTime | Prompts don't change often | ✓ Good - reduces refetching |
| Clipboard API + execCommand fallback | Browser compatibility | ✓ Good - works everywhere |
| Non-blocking AI suggestions | Enhancement not core feature | ✓ Good - graceful degradation |

**Issues Resolved:**

- German Language Risk: Resolved by choosing English prompts for video AI tools
- Supabase CLI auth: User completed manual login mid-execution
- React 19 lint errors: Refactored to composite state pattern

**Issues Deferred:**

None - all v1 requirements shipped.

**Technical Debt Incurred:**

None - clean implementation throughout milestone.

---

*For current project status, see .planning/ROADMAP.md*

---

*Archived: 2026-01-26 as part of v1.0 milestone completion*
